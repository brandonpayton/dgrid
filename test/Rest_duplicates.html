<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Test JsonRest Tree with objects repeated in different places in hierarchy</title>
		<meta name="viewport" content="width=570">
		<style>
			@import "../../dojo/resources/dojo.css";
			@import "../css/skins/claro.css";
			h2 {
				margin: 12px;
			}
			.dgrid {
				margin: 10px;
			}
		</style>
		<script src="../../dojo/dojo.js"
			data-dojo-config="async: true"></script>
		<script>
			var testStore;

			function deleteSelected(){
				for(var i in grid.selection){
					testStore.remove(i);
				}
			}
			function newPage(){
				testStore.add({
					name: "new",
					comment:"New"
				});
			}
			
			require(["dgrid/OnDemandGrid", "dgrid/Selection", "dgrid/Keyboard",
				"dgrid/editor", "dgrid/tree", "dojo/_base/declare",
				"dstore/Rest", "dstore/Observable", "dstore/Cache", 
				"dstore/SimpleQuery", "dojo/domReady!"], 
			function(Grid, Selection, Keyboard, editor, tree, declare, Rest, Observable, Cache, SimpleQuery){
				testStore = new declare([ Rest, SimpleQuery, Observable, Cache])({
					target:"./data/rest.php?", 
					idProperty: "id"
				});
				testStore.getChildren = function(parent){
					return testStore.filter({parent: parent.id});
				};
				var columns = [
					tree({label:'Name', field:'name', sortable: false, allowDuplicates: true}),
					{label:'Id', field:'id', sortable: true},
					editor({label:'Comment', field:'comment', sortable: false, autoSave: true}, "text"),
					editor({label:'Boolean', field:'boo', sortable: false, autoSave: true}, "checkbox")
				];

				var grid = window.grid = new (declare([Grid, Selection, Keyboard]))({
					collection: testStore,
					getBeforePut: false,
					columns: columns
				}, "grid");
			});
		</script>
	</head>
	<body class="claro">
		<h2>Test JsonRest Tree with objects repeated in different places in hierarchy</h2>
		<div id="grid"></div>
		<button onclick='deleteSelected();'>Delete Page</div>
		<button onclick='grid.save();'>Save</div>
		<button onclick='grid.revert();'>Revert</div>
		<button onclick='newPage();'>New Page</div>
	</body>
</html>

<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Test OnDemandGrids with promise-based stores</title>
		<link rel="stylesheet" href="../../dojo/resources/dojo.css">
		<link rel="stylesheet" href="../css/skins/claro.css">
		<style>
#grid, #grid2 {
	height: 300px;
}
		</style>
	</head>
	<body class="claro">
		<p>This test page tests two types of stores that return promises from their
		query methods: the dojo/store/DataStore wrapper for dojo/data stores,
		and an instance of dojo/store/Memory with a promise returned from query.</p>
		<h2>Grid w/ ItemFileWriteStore via DataStore</h2>
		<div>
			<button onclick="grid.set('collection', grid.collection.filter({ name: 'foo' }))">Show only items named 'foo'</button>
			<button onclick="grid.set('collection', grid.collection.store || grid.collection)">Reset query</button>
		</div>
		<div id="grid"></div>
		<h2>Grid w/ dojo/store w/ async query results</h2>
		<div id="grid2"></div>
		<script src="../../dojo/dojo.js" data-dojo-config="async:true"></script>
		<script>
require([
	"dojo/_base/declare", 
	"dojo/_base/lang", 
	"dgrid/OnDemandGrid", 
	"dgrid/test/data/createAsyncStore", 
	"dojo/store/Memory",
	"dstore/legacy/StoreAdapter", 
	"dstore/Observable",
], function(declare, lang, OnDemandGrid, createAsyncStore, LegacyMemory, StoreAdapter, Observable){
	var items = [], ifws, datastore, asyncstore, grid, grid2, i,
		names = ["sasquatch", "foo", "bar", "zaphod", "beeblebrox"];
	
	// generate data
	for(i = 1; i <= 200; i++){
		items.push({
			id: i,
			name: names[i%5]
		});
	}

	var AdaptedLegacyStore = declare([ LegacyMemory, StoreAdapter, Observable ]);
	
	var grid = window.grid = new OnDemandGrid({
		columns: { id: "id", name: "name" },
		collection: new AdaptedLegacyStore({ data: lang.clone(items) })
	}, "grid");
	
	var grid2 = window.grid2 = new OnDemandGrid({
		columns: { id: "id", name: "name" },
		collection: createAsyncStore({ data: items })
	}, "grid2");
});
		</script>
	</body>
</html>
